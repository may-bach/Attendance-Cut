<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Attendance Calculator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .initial-container-state {
      opacity: 0;
      transform: scale(0.5);
      transition: all 1.5s ease-out;
    }
    .final-container-state {
      opacity: 1;
      transform: scale(1);
    }
    .results-container {
      opacity: 0;
      transform: translateY(20px) scale(0.95);
      transition: all 0.6s ease-out;
    }
    .results-container.show {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
    .result-animation {
      animation: fadeInSlideUp 0.8s ease-out forwards;
      opacity: 0;
    }
    @keyframes fadeInSlideUp {
      0% { opacity: 0; transform: translateY(15px) scale(0.95); }
      60% { opacity: 0.8; transform: translateY(-2px) scale(1.02); }
      100% { opacity: 1; transform: translateY(0) scale(1); }
    }
    #calcBtn { transition: all 0.2s ease-in-out; }
    #calcBtn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1),
                  0 2px 4px -2px rgb(0 0 0 / 0.1);
    }
    body {
      opacity: 0;
      animation: bodyFadeIn 0.3s ease-out 0.1s forwards;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    @keyframes bodyFadeIn { to { opacity: 1; } }

    /* Dark Mode Styles */
    body.dark {
      color: #ffffff;
    }
    .dark .bg-white {
      background-color: #2a2a2a !important;
      color: #ffffff !important;
    }
    .dark input {
      background-color: #333333 !important;
      color: #ffffff !important;
      border-color: #444444 !important;
    }
    .dark input:focus {
      border-color: #555555 !important;
      outline: none !important;
    }
    .dark #calcBtn {
      background-color: #333333 !important;
    }
    .dark #calcBtn:hover {
      background-color: #444444 !important;
    }

    /* Dark Mode Toggle */
    .dark-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #f7fafc;
      color: #2d3748;
      border: 2px solid #e2e8f0;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      cursor: pointer;
      font-size: 20px;
      transition: all 0.3s ease;
      z-index: 1000;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .dark-toggle:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 12px rgba(0,0,0,0.2);
    }
    .dark .dark-toggle {
      background: #2a2a2a;
      color: #ffffff;
      border-color: #444444;
    }
  </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
  <!-- Dark Mode Toggle -->
  <button class="dark-toggle" onclick="toggleDarkMode()" title="Toggle Dark Mode">
    ◐
  </button>

  <div class="flex flex-col items-center">
    <div id="calculator-container" class="bg-white p-8 rounded-lg shadow-lg max-w-md w-full mx-4 initial-container-state">
      <h1 class="text-2xl font-bold mb-4 text-center">Attendance Calculator</h1>
      
      <label class="block mb-2">Classes Taken</label>
      <input type="number" id="taken" class="w-full p-2 border rounded mb-4" min="0">

      <label class="block mb-2">Classes Attended</label>
      <input type="number" id="attended" class="w-full p-2 border rounded mb-4" min="0">

      <label class="block mb-2">Minimum Required %</label>
      <input type="number" id="required" class="w-full p-2 border rounded mb-4" min="0" max="100">

      <label class="block mb-2">Classes per Week</label>
      <input type="number" id="perWeek" class="w-full p-2 border rounded mb-4" min="0">

      <label class="block mb-2">Weeks Remaining</label>
      <input type="number" id="weeksLeft" class="w-full p-2 border rounded mb-4" min="0">

      <button id="calcBtn" onclick="calculate()" class="w-full bg-blue-500 text-white p-2 rounded">Calculate</button>
    </div>

    <!-- Results Container -->
    <div id="results-container" class="bg-white p-6 rounded-lg shadow-lg w-full mx-4 mt-4 results-container" style="display: none; max-width: 2000px;">
      <h2 class="text-lg font-semibold mb-3 text-center text-gray-700">Results</h2>
      <p id="result" class="font-medium text-center"></p>
      <p id="cutResult" class="mt-2 text-center"></p>
    </div>
  </div>

  <script>
    let liveUpdate = false;
    let darkMode = localStorage.getItem('darkMode') === 'true';

    // Apply dark mode on page load
    window.addEventListener('load', function() {
      // Apply saved dark mode preference
      if (darkMode) {
        document.body.classList.add('dark');
        document.querySelector('.dark-toggle').textContent = '◑';
        // Force dark gray background for dark mode
        document.body.style.backgroundColor = '#1a1a1a';
      } else {
        // Ensure light mode has proper background
        document.body.style.backgroundColor = '';
      }

      // Trigger initial fade-in animation
      setTimeout(() => {
        const container = document.getElementById('calculator-container');
        container.classList.remove('initial-container-state');
        container.classList.add('final-container-state');
      }, 100);
    });

    // Toggle dark mode function
    function toggleDarkMode() {
      darkMode = !darkMode;
      document.body.classList.toggle('dark');
      const toggleBtn = document.querySelector('.dark-toggle');
      
      if (darkMode) {
        toggleBtn.textContent = '◑';
        localStorage.setItem('darkMode', 'true');
        // Force dark gray background for dark mode
        document.body.style.backgroundColor = '#1a1a1a';
      } else {
        toggleBtn.textContent = '◐';
        localStorage.setItem('darkMode', 'false');
        // Remove inline style to let Tailwind handle light mode
        document.body.style.backgroundColor = '';
      }
    }

    function calculate() {
      const taken = parseInt(document.getElementById("taken").value) || 0;
      const attended = parseInt(document.getElementById("attended").value) || 0;
      const required = parseInt(document.getElementById("required").value) || 0;
      const perWeek = parseInt(document.getElementById("perWeek").value) || 0;
      const weeksLeft = parseInt(document.getElementById("weeksLeft").value) || 0;

      const result = document.getElementById("result");
      const cutResult = document.getElementById("cutResult");
      const resultsContainer = document.getElementById("results-container");

      resultsContainer.style.display = 'block';
      result.classList.remove('result-animation');
      cutResult.classList.remove('result-animation');
      resultsContainer.classList.remove('show');
      void result.offsetHeight; void cutResult.offsetHeight; void resultsContainer.offsetHeight;

      setTimeout(() => { resultsContainer.classList.add('show'); }, 10);

      // Validation
      if (taken < 0 || attended < 0 || required < 0 || perWeek < 0 || weeksLeft < 0) {
        result.innerHTML = "Values cannot be negative.";
        cutResult.innerHTML = "";
        setTimeout(() => { result.classList.add('result-animation'); }, 10);
        return;
      }
      if (attended > taken) {
        result.innerHTML = "Classes attended cannot exceed classes taken.";
        cutResult.innerHTML = "";
        setTimeout(() => { result.classList.add('result-animation'); }, 10);
        return;
      }
      if (required > 100) {
        result.innerHTML = "Required % cannot exceed 100.";
        cutResult.innerHTML = "";
        setTimeout(() => { result.classList.add('result-animation'); }, 10);
        return;
      }

      // Attendance %
      let percentage = taken === 0 ? 0 : (attended / taken) * 100;
      let displayPercent = (percentage % 1 === 0) ? percentage.toFixed(0) : percentage.toFixed(2);

      let percentHTML = percentage < required 
        ? '<span class="text-red-600 font-bold">' + displayPercent + '%</span>'
        : '<span class="font-bold">' + displayPercent + '%</span>';

      result.innerHTML = 'Your attendance is ' + percentHTML + '.';

      // Future calculation
      const totalFutureClasses = perWeek * weeksLeft;
      let maxSkippable = Math.floor(
        (attended + totalFutureClasses) - ((required / 100) * (taken + totalFutureClasses))
      );
      if (maxSkippable < 0) maxSkippable = 0;

      if (maxSkippable > 0) {
        const plural = maxSkippable === 1 ? "class" : "classes";
        cutResult.innerHTML = 'You can skip <span class="text-green-700 underline font-bold">' 
          + maxSkippable + '</span> ' + plural + ' in the upcoming weeks.';
      } else {
        cutResult.innerHTML = 'You can skip <span class="text-red-600 underline font-bold">0</span> classes in the upcoming weeks.';
      }

      setTimeout(() => { result.classList.add('result-animation'); }, 10);
      setTimeout(() => { cutResult.classList.add('result-animation'); }, 150);

      if (!liveUpdate) {
        liveUpdate = true;
        ["taken", "attended", "required", "perWeek", "weeksLeft"].forEach(id => {
          document.getElementById(id).addEventListener("input", calculate);
        });
      }
    }
  </script>
</body>
</html>
